
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../swe/cicd/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>DataLoading - Software Development Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview-of-how-plinker-data-is-prepped-for-training" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Software Development Notes" class="md-header__button md-logo" aria-label="Software Development Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M348.8 32C340.7 46.1 336 62.5 336 80v16H64v224h272v64H64c-35.3 0-64-28.7-64-64V96c0-35.3 28.7-64 64-64zM336 432c0 17.5 4.7 33.9 12.8 48H120c-13.3 0-24-10.7-24-24s10.7-24 24-24zm96-400h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48h-96c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48m24 64c-13.3 0-24 10.7-24 24s10.7 24 24 24h48c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h48c13.3 0 24-10.7 24-24s-10.7-24-24-24zm56 144a32 32 0 1 0-64 0 32 32 0 1 0 64 0"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Software Development Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DataLoading
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Software Development Notes" class="md-nav__button md-logo" aria-label="Software Development Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M348.8 32C340.7 46.1 336 62.5 336 80v16H64v224h272v64H64c-35.3 0-64-28.7-64-64V96c0-35.3 28.7-64 64-64zM336 432c0 17.5 4.7 33.9 12.8 48H120c-13.3 0-24-10.7-24-24s10.7-24 24-24zm96-400h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48h-96c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48m24 64c-13.3 0-24 10.7-24 24s10.7 24 24 24h48c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h48c13.3 0 24-10.7 24-24s-10.7-24-24-24zm56 144a32 32 0 1 0-64 0 32 32 0 1 0 64 0"/></svg>

    </a>
    Software Development Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Software Development Essentials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Software Development Essentials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../swe/gettingstarted/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../swe/httpbasics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTTP Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    FastAPI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            FastAPI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../swe/fastapitutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../swe/fastapivalidation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Backend
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Backend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../swe/servicelayerdi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Layer and Dependency Injection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../swe/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../swe/cicd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to CI/CD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    GigMatcher
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            GigMatcher
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    DataLoading
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    DataLoading
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-create-data-splits-make_plinder_split_parquetpy" class="md-nav__link">
    <span class="md-ellipsis">
      1. Create Data Splits (make_plinder_split_parquet.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-create-raw-data-directories-make_plinder_data_dirpy" class="md-nav__link">
    <span class="md-ellipsis">
      2. Create Raw Data Directories (make_plinder_data_dir.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-preprocess-raw-data-preprocess_plinder_datapy" class="md-nav__link">
    <span class="md-ellipsis">
      3. Preprocess Raw Data (preprocess_plinder_data.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-optional-pre-generate-gigs-pregenerate_gigspy" class="md-nav__link">
    <span class="md-ellipsis">
      4. (Optional) Pre-generate GIGs (pregenerate_gigs.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-make_plpinder_split_parquetpy" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding make_plpinder_split_parquet.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding make_plpinder_split_parquet.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-first-the-function-reads-the-database-and-makes-a-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      1. First the function reads the database and makes a dataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-second-the-function-filters-entries" class="md-nav__link">
    <span class="md-ellipsis">
      2. Second the function filters entries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-return-the-cleaned-data" class="md-nav__link">
    <span class="md-ellipsis">
      3. Return the cleaned data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-create-data-splits-make_plinder_split_parquetpy" class="md-nav__link">
    <span class="md-ellipsis">
      1. Create Data Splits (make_plinder_split_parquet.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-create-raw-data-directories-make_plinder_data_dirpy" class="md-nav__link">
    <span class="md-ellipsis">
      2. Create Raw Data Directories (make_plinder_data_dir.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-preprocess-raw-data-preprocess_plinder_datapy" class="md-nav__link">
    <span class="md-ellipsis">
      3. Preprocess Raw Data (preprocess_plinder_data.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-optional-pre-generate-gigs-pregenerate_gigspy" class="md-nav__link">
    <span class="md-ellipsis">
      4. (Optional) Pre-generate GIGs (pregenerate_gigs.py)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-make_plpinder_split_parquetpy" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding make_plpinder_split_parquet.py
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding make_plpinder_split_parquet.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-first-the-function-reads-the-database-and-makes-a-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      1. First the function reads the database and makes a dataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-second-the-function-filters-entries" class="md-nav__link">
    <span class="md-ellipsis">
      2. Second the function filters entries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-return-the-cleaned-data" class="md-nav__link">
    <span class="md-ellipsis">
      3. Return the cleaned data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="overview-of-how-plinker-data-is-prepped-for-training">Overview of How Plinker Data is Prepped for Training</h1>
<p>The entire process for how PLINDER data is prepped and transformed into the dataset used for training is managed by scripts in the <code>gigmatcher/scripts/data_prep/</code> directory</p>
<h3 id="1-create-data-splits-make_plinder_split_parquetpy">1. <strong>Create Data Splits (<code>make_plinder_split_parquet.py</code>)</strong></h3>
<p>This is the first step, which defines the train, validation, and test sets.</p>
<ol>
<li>
<p><strong>Query PLINDER</strong>: It queries the full PLINDER database to get a list of all protein-ligand systems.</p>
</li>
<li>
<p><strong>Filter Entries</strong>: It filters this list, removing entries with fewer than a minimum number of interacting residues (e.g., 2).</p>
</li>
<li>
<p><strong>Get Clusters</strong>: It loads PLINDER's pre-computed cluster dataframes (<code>val_cluster_df</code>, <code>test_cluster_df</code>) to assign a cluster label to each system. This ensures that structurally similar proteins are kept in the same split.</p>
</li>
<li>
<p><strong>Remove Benchmarks</strong>: It has options to identify systems related to common benchmarks (like <code>remove_matcher_benchmark</code>) and move them from the training set to the validation set to prevent data leakage and ensure fair evaluation.</p>
</li>
<li>
<p><strong>Output</strong>: It saves separate <code>_train.pq</code>, <code>_val.pq</code>, and <code>_test.pq</code> parquet files (and a <code>.json</code> file) that list the <code>system_ids</code> and cluster information for each split.</p>
</li>
</ol>
<h3 id="2-create-raw-data-directories-make_plinder_data_dirpy">2. <strong>Create Raw Data Directories (<code>make_plinder_data_dir.py</code>)</strong></h3>
<p>This script transforms the parquet files (lists of systems) into the raw file structure needed for processing.</p>
<ol>
<li>
<p><strong>Read Splits</strong>: It reads one of the parquet files from Step 1 (e.g., <code>plinder_splits_train_pq.gz</code>).</p>
</li>
<li>
<p><strong>Create Folders</strong>: For each <code>system_id</code> in the file, it creates a subdirectory (e.g., <code>/path/to/plinder_train_raw/&lt;system_id&gt;/</code>).</p>
</li>
<li>
<p><strong>Copy/Convert Files</strong>:</p>
<ul>
<li>It copies the system's receptor PDB file from the PLINDER database into its new folder as <code>&lt;system_id&gt;_protein.pdb</code>.</li>
<li>It finds all associated ligand <code>.sdf</code> files for that system, combines them, and converts them into a single <code>&lt;system_id&gt;_ligand.mol2</code> file using <code>obabel</code>.</li>
</ul>
</li>
</ol>
<h3 id="3-preprocess-raw-data-preprocess_plinder_datapy">3. <strong>Preprocess Raw Data (<code>preprocess_plinder_data.py</code>)</strong></h3>
<p>This is the main transformation step. It takes the raw <code>_protein.pdb</code> and <code>_ligand.mol2</code> files and generates the final training data.</p>
<ol>
<li>
<p><strong>Combine Protein &amp; Ligand</strong>: It first combines the <code>&lt;system_id&gt;_protein.pdb</code> and <code>&lt;system_id&gt;_ligand.mol2</code> files into a single <code>_protein_ligand.pdb</code> file.</p>
</li>
<li>
<p><strong>Load &amp; Idealize</strong>: The script loads this combined PDB into a Protein object. It then idealizes the protein's sidechains by calculating their chi angles and rebuilding them from standard bond lengths/angles. This ensures a clean, standardized geometry.</p>
</li>
<li>
<p><strong>Run Reduce</strong>: It runs the Reduce tool on the idealized protein-ligand structure. This adds and optimizes hydrogen atoms. It uses a custom connectivity database (<code>_reduce_conect.db</code>) generated from the <code>.mol2</code> file to correctly handle the ligand.</p>
</li>
<li>
<p><strong>Extract GIGs</strong>:</p>
<ul>
<li><strong>All Components</strong>: It scans the final, reduced protein and extracts all possible GIG components (all "NH", "CO", "OH", "COO", etc. interacting pairs) and saves them as <code>&lt;system_id&gt;_gig-comps.npz</code>. This file represents the entire "GIG library" available in that one protein.</li>
<li><strong>Ligand GIG</strong>: It separately analyzes the protein-ligand interface and extracts the specific GIG representing the functional site (i.e., the components interacting with the ligand). This is saved as <code>&lt;system_id&gt;_ligand-gig.npz</code>.</li>
</ul>
</li>
<li>
<p><strong>Save Processed Protein</strong>: Finally, it saves the processed protein (with idealized sidechains and added hydrogens) as <code>&lt;system_id&gt;_protein.npz</code>, which stores its atomic coordinates, masks, and sequence information in NumPy arrays.</p>
</li>
</ol>
<h3 id="4-optional-pre-generate-gigs-pregenerate_gigspy">4. <strong>(Optional) Pre-generate GIGs (<code>pregenerate_gigs.py</code>)</strong></h3>
<p>This step is for efficiency. Instead of sampling random GIGs from <code>_gig-comps.npz</code> during training, this script does it ahead of time.</p>
<ol>
<li>
<p><strong>Load Data</strong>: It loads the <code>_gig-comps.npz</code> (all components) and <code>_protein.npz</code> files.</p>
</li>
<li>
<p><strong>Sample GIGs</strong>: It generates many (e.g., 250) random GIGs for the protein by sampling from its full component set, using various filters like max distance and component type biases (e.g., centrality, amino acid type).</p>
</li>
<li>
<p><strong>Output</strong>: It saves an array of the indices for these pre-sampled GIGs into a <code>&lt;system_id&gt;_gig-comp-indices.npy</code> file.</p>
</li>
</ol>
<p>At the end of this pipeline, a single PLINDER system is transformed into a set of <code>.npz</code> and <code>.npy</code> files that contain the processed protein scaffold, its full component library, its specific ligand-binding GIG, and (optionally) a list of pre-sampled GIGs for training.</p>
<h2 id="understanding-make_plpinder_split_parquetpy">Understanding <code>make_plpinder_split_parquet.py</code></h2>
<p>The <code>main</code> function's job is to query the entire PLINDER database, clean and filter all the protein-ligand systems, and then carefully divide them into <strong>train</strong>, <strong>validation</strong>, and <strong>test</strong> sets. </p>
<p>Its main goal is to prevent <strong>data leakage</strong>, which means ensuring that proteins in the training set are not structurally similar to proteins in the validation or test sets. It does this by using pre-computed "clusters" (groups of similar proteins).</p>
<ol>
<li>
<p>Gets the start time to track how long the main functions runs for
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">outfile_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">use_gz</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> 
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">min_interacting_res</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">remove_matcher_benchmark</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> 
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">remove_rfd2_benchmark</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="c1">### Rest of the code...</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saved final datasets to </span><span class="si">{</span><span class="n">outfiles</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> sec&#39;</span><span class="p">)</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="c1">### More code...</span>
</span></code></pre></div></p>
</li>
<li>
<p>Load all data by calling <code>load_full_plinder_df()</code>. This function queries the PLINDER database and loads all protein-ligand systems into a giant pandas DataFrame. It filters this list, keeping only systems that have at least <code>min_interacting_res</code> (e.g., 2) residues interacting with the ligand.
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Read full dataset with specific columns</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="n">cols_of_interest</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>        <span class="s2">&quot;system_id&quot;</span><span class="p">,</span> 
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>        <span class="s2">&quot;entry_pdb_id&quot;</span><span class="p">,</span> 
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        <span class="s2">&quot;ligand_ccd_code&quot;</span><span class="p">,</span> 
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>        <span class="s2">&quot;ligand_plip_type&quot;</span><span class="p">,</span> 
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>        <span class="s2">&quot;ligand_interacting_residues&quot;</span><span class="p">,</span> 
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        <span class="s2">&quot;ligand_interactions&quot;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="p">]</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="n">full_df</span> <span class="o">=</span> <span class="n">load_full_plinder_df</span><span class="p">(</span><span class="n">cols_of_interest</span><span class="p">,</span> <span class="n">min_interacting_res</span><span class="p">)</span>
</span></code></pre></div></p>
<div class="admonition info">
<p class="admonition-title">load_full_plinder_df()</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_full_plinder_df</span><span class="p">(</span><span class="n">cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">min_interacting_res</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">drop_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="c1"># Read full dataset with specific columns</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">full_df</span> <span class="o">=</span> <span class="n">query_index</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">splits</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">])</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="c1"># Filter out entries with &lt; min_interacting_res interacting residues</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">entry_mask</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ligand_interacting_residues&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">min_interacting_res</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">full_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="k">if</span> <span class="n">drop_duplicates</span><span class="p">:</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>        <span class="k">return</span> <span class="n">full_df</span><span class="p">[</span><span class="n">entry_mask</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;system_id&quot;</span><span class="p">)</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="k">return</span> <span class="n">full_df</span><span class="p">[</span><span class="n">entry_mask</span><span class="p">]</span>
</span></code></pre></div>
This function's purpose is to query the main PLINDER database and then clean that data based on two criteria: the number of interacting residues and whether to remove duplicates.</p>
<ul>
<li><code>drop_duplicates: bool = True</code>: A boolean (True/False) flag. If it's <code>True</code>, the function will remove duplicate entries. It's set to <code>True</code> by default.</li>
</ul>
<h4 id="1-first-the-function-reads-the-database-and-makes-a-dataframe">1. First the function reads the database and makes a <code>dataframe</code></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">full_df</span> <span class="o">=</span> <span class="n">query_index</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">splits</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">])</span>
</span></code></pre></div>
<ul>
<li><code>query_index</code> function is imported from PLINDER</li>
<li>
<p><code>columns=cols</code>: It tells the query to only fetch the columns specified in the cols list that was passed into the function.</p>
</li>
<li>
<p><code>splits=["*"]</code>: This is a wildcard, telling the query to fetch data from all splits (train, val, test, etc.) in the database.</p>
</li>
</ul>
<h4 id="2-second-the-function-filters-entries">2. Second the function filters entries</h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">entry_mask</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ligand_interacting_residues&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">min_interacting_res</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">full_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
</span></code></pre></div>
<ul>
<li>This line builds a "mask," which is a list of <code>True</code> and <code>False</code> values</li>
<li>It loops through every row in the dataframe and it gets the value from the <code>ligand_interacting_residues</code> column and calculates its length (i.e., how many interacting residues there are).</li>
<li>It checks if that number is greater than or equal to the <code>min_interacting_res</code> value and the entry_mask will mark which rows to keep(<code>True</code>) and which to discard (<code>False</code>).</li>
</ul>
<h4 id="3-return-the-cleaned-data">3. Return the cleaned data</h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">if</span> <span class="n">drop_duplicates</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="k">return</span> <span class="n">full_df</span><span class="p">[</span><span class="n">entry_mask</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;system_id&quot;</span><span class="p">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="k">return</span> <span class="n">full_df</span><span class="p">[</span><span class="n">entry_mask</span><span class="p">]</span>
</span></code></pre></div>
<ul>
<li>returns the cleaned data depending on the <code>drop_duplicates</code> flag</li>
</ul>
</div>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>